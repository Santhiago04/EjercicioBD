-- 1. Crear la base de datos llamada Tienda Online
CREATE DATABASE Tienda_Online;

-- 2. Usar la base de datos llamada Tienda Online
USE Tienda_Online;

/*3. CREAR TABLAS:
	- Producto (id -> Autoincrement)
    - Usuario
    - Clientes (Autoincrement)
    - Ventas u (id -> autoincrement, # de ordenes) */
CREATE TABLE Producto (
    codigoBarras INT AUTO_INCREMENT PRIMARY KEY,
    nombreProducto VARCHAR(50),
    categoriaProducto VARCHAR(50),
    precioProducto DECIMAL(10, 2),
    cantidadProducto INT
);

CREATE TABLE Usuario (
    idUsuario INT AUTO_INCREMENT PRIMARY KEY,
    nombreUsuario VARCHAR(50),
    rolUsuario VARCHAR(50)
);

CREATE TABLE Cliente (
    idCliente INT AUTO_INCREMENT PRIMARY KEY,
    nombreCliente VARCHAR(50),
    fechaNacimiento DATE
);

CREATE TABLE Venta (
    idVenta INT AUTO_INCREMENT PRIMARY KEY,
    fechaVenta DATE,
    totalVenta DECIMAL(10, 2),
    idClienteFK INT,
    idUsuarioFK INT,
    
    CONSTRAINT FK_Cliente_Venta FOREIGN KEY (idClienteFK) REFERENCES Cliente(idCliente),
    CONSTRAINT FK_Usuario_Venta FOREIGN KEY (idUsuarioFK) REFERENCES Usuario(idUsuario)
);
CREATE TABLE DetalleVenta (
    idDetalleVenta INT AUTO_INCREMENT PRIMARY KEY,
    idVentaFK INT,
    idProductoFK INT,
    cantidad INT,
    precioUnitario DECIMAL(10, 2),

    CONSTRAINT FK_Venta_Detalle FOREIGN KEY (idVentaFK) REFERENCES Venta(idVenta),
    CONSTRAINT FK_Producto_Detalle FOREIGN KEY (idProductoFK) REFERENCES Producto(codigoBarras)
);

/* 5. HACER MÍNIMO 4 INSERCIONES POR TABLA */

-- Insertar en la tabla Producto
INSERT INTO Producto (nombreProducto, categoriaProducto, precioProducto, cantidadProducto)
VALUES
('Producto 1', 'Categoria 1', 10000, 5),
('Producto 2', 'Categoria 1', 18000, 3),
('Producto 3', 'Categoria 2', 25000, 1),
('Producto 4', 'Categoria 3', 50000, 2);

-- Insertar en la tabla Cliente
INSERT INTO Cliente (nombreCliente, fechaNacimiento)
VALUES
('Daniel', '2002-05-13'),
('Daniela', '2002-02-13'),
('Daniele', '2002-10-13'),
('Danielo', '2002-01-13');

-- Insertar en la tabla Usuario
INSERT INTO Usuario (nombreUsuario, rolUsuario)
VALUES
('Daniel Cajero', 'Cajero'),
('Daniel Administrador', 'Administrador'),
('Daniel Secretario', 'Secretario'),
('Daniel Ejecutivo', 'Ejecutivo');

-- Insertar en la tabla Venta
INSERT INTO Venta (fechaVenta, totalVenta, idClienteFK, idUsuarioFK)
VALUES
('2024-05-10', 50000, 1, 1),
('2024-06-15', 30000, 2, 2),
('2024-07-20', 25000, 3, 3),
('2024-08-25', 18000, 4, 4);

-- Insertar en la tabla DetalleVenta
INSERT INTO DetalleVenta (idVentaFK, idProductoFK, cantidad, precioUnitario)
VALUES
(1, 1, 2, 10000),
(2, 2, 1, 18000),
(3, 3, 1, 25000),
(4, 4, 1, 50000);

-- 6. Consultas:

-- a. Consulta general de todos los productos
SELECT * FROM Producto;

-- b. Ordenar productos por precio de menor a mayor
SELECT * FROM Producto ORDER BY precioProducto ASC;

-- c. Consultar los clientes que nacen en enero
SELECT * FROM Cliente WHERE MONTH(fechaNacimiento) = 1;

-- d. Consultar los usuarios con rol de empleado
SELECT * FROM Usuario WHERE rolUsuario = 'Cajero' OR rolUsuario = 'Secretario';

-- e. Consultar las órdenes generadas entre marzo y junio
SELECT * FROM Venta WHERE MONTH(fechaVenta) BETWEEN 3 AND 6;

-- f. Consultar los productos que contengan la letra 'r'
SELECT * FROM Producto WHERE nombreProducto LIKE '%r%';

-- g. Consultar las ventas con productos de precio 15,000 o 30,000
SELECT * FROM Venta v
JOIN DetalleVenta dv ON v.idVenta = dv.idVentaFK
JOIN Producto p ON dv.idProductoFK = p.codigoBarras
WHERE p.precioProducto BETWEEN 15000 AND 30000;

/* REGISTRAR USUARIOS DANIEL Y TATIANA, también crear un nuevo producto (ropa de bebé)
   Tatiana va a comprar ropa de bebé (registrar la venta */
   
SELECT * FROM Producto;
INSERT INTO Producto (nombreProducto, categoriaProducto, precioProducto, cantidadProducto)
VALUES
('Ropa de bebé', 'Categoria 1', 25000, 5);

SELECT * FROM Cliente;
-- Agregando los atributos que hacen falta

ALTER TABLE Cliente 
ADD direccionCliente varchar(50);

ALTER TABLE Cliente
ADD telefonoCliente int(10);

INSERT INTO Cliente(idCliente, nombreCliente, fechaNacimiento)
	VALUES (55163118, 'Tatiana Cabrera', '1985-11-24' );

-- Actualizando los datos de un cliente
UPDATE Cliente 
SET fechaNacimiento = '1985-11-24', direccionCliente = 'Calle 104 #13-14', telefonoCliente = 3144606918
WHERE idCliente =55163118;


-- Insertando la venta
ALTER TABLE Venta
ADD COLUMN idProductoFK int;


SELECT * FROM Producto;
-- Agregando FK de ID producto
ALTER TABLE Venta 
ADD CONSTRAINT FOREIGN KEY (idProductoFK)
REFERENCES Producto(codigoBarras);

ALTER TABLE Venta
DROP COLUMN productosComprados;

SELECT * FROM Venta;
INSERT INTO VENTA (idVenta, fechaVenta, idClienteFK, idUsuarioFK, idProductoFK)
VALUES ('6', '2024-09-27', 55163118, 2, 5);

SELECT * FROM Venta;
